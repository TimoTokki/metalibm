# This script will download and install several things in the current directory.
# You should therefore probably run it in a new empty directory.
# Dependencies
# sudo apt-get install python-dev libmpfr-dev libfplll-dev libmpfi-dev libgmp-dev libxml2-dev


# INSTALLATION
LOCAL_DIR=$PWD
INSTALL_DIR=$PWD/local_install

git submodule update --init --recursive 
cd $LOCAL_DIR 
mkdir $INSTALL_DIR 
wget https://gforge.inria.fr/frs/download.php/33151/sollya-4.1.tar.gz 
tar -xzf sollya-4.1.tar.gz 
cd sollya-4.1/ && ./configure --prefix=$INSTALL_DIR && make -j 4 && make install 
cd $LOCAL_DIR 
cd pythonsollya/ && LOCAL_INSTALL_DIR=$INSTALL_DIR python setup.py build && python setup.py install --prefix $INSTALL_DIR  
cd $LOCAL_DIR 
LOCAL_PYTHON_PATH=$(find $INSTALL_DIR -name pythonsollya | sed -e "s/pythonsollya//")
echo "export PYTHONPATH=$LOCAL_DIR/metalibm-lugdunum/:$LOCAL_PYTHON_PATH:$PYTHONPATH" > $INSTALL_DIR/metalibm_setup_env.bash 
# USAGE EXAMPLE

source $INSTALL_DIR/metalibm_setup_env.bash 
python metalibm-lugdunum/metalibm_functions/ml_exp.py --target x86_fma --output x86_fma_exp2d.c 
python metalibm-lugdunum/metalibm_functions/ml_exp.py --disable-fma --target x86_sse41 --output x86_sse41_exp2d.c
